version: 2 
jobs: 
  docker_image_build: 
    machine: 
      docker_layer_caching: true
    steps: 
      - checkout 
      # DLC will explicitly cache layers here and try to avoid rebuilding.
      - run: rake docker
  debug_qemu_build: 
    machine: 
      docker_layer_caching: true
    resource_class: xlarge
    steps: 
      - checkout 
      - run: git submodule update --init --recursive
      # DLC will explicitly cache layers here and try to avoid rebuilding.
      - run: rake debug:build_qemu

workflows:
  version: 2
  debug-qemu-build:
    jobs:
      - docker_image_build
      - debug_qemu_build:
          requires:
            - docker_image_build